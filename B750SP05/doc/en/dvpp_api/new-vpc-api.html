
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>New VPC API  Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-expandable-chapters/expandable-chapters-theme.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-copy/css/copy.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="old-vpc-api.html" />
    
    
    <link rel="prev" href="dvppctl.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="dvpp-external-apis.html">
            
                <a href="dvpp-external-apis.html">
            
                    
                    DVPP External APIs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="createdvppapi.html">
            
                <a href="createdvppapi.html">
            
                    
                    CreateDvppApi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="dvppctl.html">
            
                <a href="dvppctl.html">
            
                    
                    DvppCtl
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.3.2.1" data-path="new-vpc-api.html">
            
                <a href="new-vpc-api.html">
            
                    
                    New VPC API 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="old-vpc-api.html">
            
                <a href="old-vpc-api.html">
            
                    
                    Old VPC API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="cmdlist.html">
            
                <a href="cmdlist.html">
            
                    
                    CMDLIST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="vdec.html">
            
                <a href="vdec.html">
            
                    
                    VDEC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="jpege.html">
            
                <a href="jpege.html">
            
                    
                    JPEGE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="jpegd.html">
            
                <a href="jpegd.html">
            
                    
                    JPEGD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="pngd.html">
            
                <a href="pngd.html">
            
                    
                    PNGD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="venc.html">
            
                <a href="venc.html">
            
                    
                    VENC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9" data-path="querying-dvpp-engine-capabilities.html">
            
                <a href="querying-dvpp-engine-capabilities.html">
            
                    
                    Querying DVPP Engine Capabilities
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="destroydvppapi.html">
            
                <a href="destroydvppapi.html">
            
                    
                    DestroyDvppApi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="exception-handling.html">
            
                <a href="exception-handling.html">
            
                    
                    Exception Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="appendix.html">
            
                <a href="appendix.html">
            
                    
                    Appendix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="input-parameter-structures.html">
            
                <a href="input-parameter-structures.html">
            
                    
                    Input Parameter Structures
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="structures-in-vpc_in_msg.html">
            
                <a href="structures-in-vpc_in_msg.html">
            
                    
                    Structures in vpc_in_msg
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1.1" data-path="rawdata_overlay_config.html">
            
                <a href="rawdata_overlay_config.html">
            
                    
                    rawdata_overlay_config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.2" data-path="rawdata_collage_config.html">
            
                <a href="rawdata_collage_config.html">
            
                    
                    rawdata_collage_config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.3" data-path="rdmachannel.html">
            
                <a href="rdmachannel.html">
            
                    
                    RDMACHANNEL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.4" data-path="vpcturningreverse.html">
            
                <a href="vpcturningreverse.html">
            
                    
                    VpcTurningReverse
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="structures-in-vpcuserimageconfigure.html">
            
                <a href="structures-in-vpcuserimageconfigure.html">
            
                    
                    Structures in VpcUserImageConfigure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="structures-and-classes-in-vdec_in_msg.html">
            
                <a href="structures-and-classes-in-vdec_in_msg.html">
            
                    
                    Structures and Classes in vdec_in_msg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="structures-in-image_config.html">
            
                <a href="structures-in-image_config.html">
            
                    
                    Structures in IMAGE_CONFIG
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.5" data-path="structures-in-dvpp_engine_capability_stru.html">
            
                <a href="structures-in-dvpp_engine_capability_stru.html">
            
                    
                    Structures in dvpp_engine_capability_stru
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="dvpp-executor-tool-instructions.html">
            
                <a href="dvpp-executor-tool-instructions.html">
            
                    
                    DVPP Executor Tool Instructions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="environment-preparation.html">
            
                <a href="environment-preparation.html">
            
                    
                    Environment Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="input-parameters-of-the-dvpp-executor-tool.html">
            
                <a href="input-parameters-of-the-dvpp-executor-tool.html">
            
                    
                    Input Parameters of the DVPP Executor Tool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="vpc-instructions.html">
            
                <a href="vpc-instructions.html">
            
                    
                    VPC Instructions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.3.1" data-path="basic-functions-of-the-vpc.html">
            
                <a href="basic-functions-of-the-vpc.html">
            
                    
                    Basic Functions of the VPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3.2" data-path="vpc-raw-data-8k.html">
            
                <a href="vpc-raw-data-8k.html">
            
                    
                    VPC Raw Data 8K
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="cmdlist-instructions.html">
            
                <a href="cmdlist-instructions.html">
            
                    
                    CMDLIST Instructions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="vdec-instructions.html">
            
                <a href="vdec-instructions.html">
            
                    
                    VDEC Instructions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="venc-instructions.html">
            
                <a href="venc-instructions.html">
            
                    
                    VENC Instructions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.7" data-path="jpege-instructions.html">
            
                <a href="jpege-instructions.html">
            
                    
                    JPEGE Instructions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.8" data-path="jpegd-instructions.html">
            
                <a href="jpegd-instructions.html">
            
                    
                    JPEGD Instructions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.9" data-path="pngd-instructions.html">
            
                <a href="pngd-instructions.html">
            
                    
                    PNGD Instructions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="acronyms-and-abbreviations.html">
            
                <a href="acronyms-and-abbreviations.html">
            
                    
                    Acronyms and Abbreviations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="auxiliary-function-apis.html">
            
                <a href="auxiliary-function-apis.html">
            
                    
                    Auxiliary Function APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="list-of-apis-that-are-not-recommended.html">
            
                <a href="list-of-apis-that-are-not-recommended.html">
            
                    
                    List of APIs that Are Not Recommended
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >New VPC API </a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="new-vpc-api-">New VPC API <a id="EN-US_TOPIC_0133344557"></a></h1>
<p><strong>It is recommended to use the new VPC API</strong>. The new VPC API includes all functional modules of the VPC and CMDLIST. You are advised to use this API for development and migrate the old VPC and CMDLIST APIs to the new API.</p>
<p>The new API can be used to:</p>
<ul>
<li>Crop and scale up/down a single image.</li>
<li>Perform multi-ROI cropping on an image and scaled output.</li>
<li>Scale the width and height of an image by the same proportion.</li>
<li>Specify the output area.</li>
<li>Reduce the number of bits</li>
<li>Convert the image format</li>
<li>Perform overlay and stitching.</li>
<li>Image gray-scale</li>
</ul>
<p>The performance specifications of VPC channels (the number of which is not limited) are as follows:</p>
<p>The VPC performance will be changed when the resolution is changed during image processing, such as image cropping and scaling. When the resolution of an image is less than or equal to that of the original image, the performance specifications in the typical scenario are as follows:</p>
<p><a id="table4179193581715"></a></p>
<table><thead align="left"><tr id="row71901935201711"><th class="cellrowborder" valign="top" width="50%" id="mcps1.1.3.1.1"><p id="p1420115616174"><a id="p1420115616174"></a><a id="p1420115616174"></a>Scene</p>
</th>
<th class="cellrowborder" valign="top" width="50%" id="mcps1.1.3.1.2"><p id="p2198435101713"><a id="p2198435101713"></a><a id="p2198435101713"></a>Total Frame Rate</p>
</th>
</tr>
</thead>
<tbody><tr id="row6202103521717"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.1.3.1.1 "><p id="p1420603516176"><a id="p1420603516176"></a><a id="p1420603516176"></a>1080p x 32 channels</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.1.3.1.2 "><p id="p420953531714"><a id="p420953531714"></a><a id="p420953531714"></a>1440 fps</p>
</td>
</tr>
<tr id="row202111435131714"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.1.3.1.1 "><p id="p417812431917"><a id="p417812431917"></a><a id="p417812431917"></a>4K x 4 channels</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.1.3.1.2 "><p id="p15218035101710"><a id="p15218035101710"></a><a id="p15218035101710"></a>360 fps</p>
</td>
</tr>
</tbody>
</table>

<p>When the resolution of an image is greater than that of the original image, the formula for calculating the total frame rate is as follows:</p>
<p>Total frame rate = (3840 x 2160 x 360)/(W x H) fps</p>
<p>Where,  <strong>W</strong>  and  <strong>H</strong>  are the maximum width and height during the VPC processing. For example, a 1080p image is cropped to 960 x 540 and then scaled to 3840 x 2160. In this case,  <strong>W</strong>  is 3840 pixels and  <strong>H</strong>  is 2160 pixels.</p>
<p>During the processing, if the scaling-down ratio is increased, the VPC processing performance slightly decreases.</p>
<ul>
<li><p>Restrictions on the width and height of the input and output images:</p>
<ul>
<li>The width and height of the input image must be 2-pixel aligned (even numbers).</li>
<li><p>The width and height of the output image must be 2-pixel aligned (even numbers).</p>
<blockquote>
<p><img src="public_sys-resources/icon-notice.gif" alt=""> <strong>NOTICE:</strong><br>The image width and height mentioned here refer to the valid area of an image. Actually, the buffer for the data that is sent to the VPC needs to be aligned by 128 x 16.  </p>
</blockquote>
</li>
</ul>
</li>
<li><p>Restrictions on the buffers of the input and output images of the VPC:</p>
<ul>
<li><p>Restrictions on the input buffer of the VPC:</p>
<ul>
<li>Input data address (OS virtual address): 128-byte aligned</li>
<li>Buffer restriction for the input image width: 128-byte aligned</li>
<li>Buffer restriction for the input image height: 16-byte aligned</li>
</ul>
<blockquote>
<p><img src="public_sys-resources/icon-note.gif" alt=""> <strong>NOTE:</strong><br>For an image in YUV400sp format, the caller must allocate a space of the same size as the YUV420sp format, that is, width_align_128 x high_align_16 x 1.5.  </p>
</blockquote>
</li>
<li><p>Restrictions on the output buffer of the VPC:</p>
<ul>
<li>Output data address (OS virtual address): 128-byte aligned</li>
<li>Buffer restriction for the output image width: 128-byte aligned</li>
<li>Buffer restriction for the output image height: 16-byte aligned</li>
</ul>
</li>
<li><p>The virtual addresses of the input and output caches for the same task should be in the same 4 GB space.</p>
</li>
</ul>
</li>
</ul>
<p>The following figure shows the normalization function of the new VPC API.</p>
<p><strong>Figure  1</strong>  VPC normalization function<a id="fig15358550161512"></a><br><img src="figures/vpc-normalization-function.png" alt="" title="vpc-normalization-function"></p>
<blockquote>
<p><img src="public_sys-resources/icon-note.gif" alt=""> <strong>NOTE:</strong>   </p>
<ul>
<li>The output image refers to the image of the output buffer allocated by users.  </li>
<li>The overridden area refers to the specified output area.  </li>
<li>The width stride of an image is not exactly the same as the width of the image resolution.  </li>
<li>The height stride indicates the number of lines in the buffer.  </li>
</ul>
</blockquote>
<p>The following uses YUV420sp and ARGB and as an example.</p>
<p><img src="figures/en-us_image_0160667850.png" alt=""></p>
<h2 id="input-parameter-vpcuserimageconfigure">Input Parameter: VpcUserImageConfigure<a id="section2262272506"></a></h2>
<p><a id="table2484886"></a></p>
<table><thead align="left"><tr id="row32559554"><th class="cellrowborder" valign="top" width="19%" id="mcps1.1.4.1.1"><p id="p20078207"><a id="p20078207"></a><a id="p20078207"></a>Member Variable</p>
</th>
<th class="cellrowborder" valign="top" width="42.39%" id="mcps1.1.4.1.2"><p id="p15722052"><a id="p15722052"></a><a id="p15722052"></a>Description</p>
</th>
<th class="cellrowborder" valign="top" width="38.61%" id="mcps1.1.4.1.3"><p id="p65526714"><a id="p65526714"></a><a id="p65526714"></a>Value Range</p>
</th>
</tr>
</thead>
<tbody><tr id="row52869519"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p54572624"><a id="p54572624"></a><a id="p54572624"></a>uint8_t* bareDataAddr</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p58306455"><a id="p58306455"></a><a id="p58306455"></a>Address of an input image in uncompressed format. If the input image is in compressed format, this parameter does not need to be set. The default value is <strong id="b11684114651415"><a id="b11684114651415"></a><a id="b11684114651415"></a>null</strong>.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p18493949193816"><a id="p18493949193816"></a><a id="p18493949193816"></a>--</p>
</td>
</tr>
<tr id="row42749614"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p40166689"><a id="p40166689"></a><a id="p40166689"></a>uint32_t bareDataBufferSize;</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p2460440143917"><a id="p2460440143917"></a><a id="p2460440143917"></a>Buffer size of the input image in uncompressed format. The buffer size is calculated based on the width and height strides of the image. When the input image is in compressed format, this parameter does not need to be set. The default value is <strong id="b714875117142"><a id="b714875117142"></a><a id="b714875117142"></a>0</strong>.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p69291543114010"><a id="p69291543114010"></a><a id="p69291543114010"></a>--</p>
</td>
</tr>
<tr id="row10278168"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p27225255"><a id="p27225255"></a><a id="p27225255"></a>uint32_t widthStride</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p57762035"><a id="p57762035"></a><a id="p57762035"></a>Height stride of an image. The ratio of the stride to the width varies with the image format.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p137781355184519"><a id="p137781355184519"></a><a id="p137781355184519"></a>YUV400sp, YUV420sp, YUV422sp, and YUV444sp: The width of the active area of an image is 128-pixel aligned.</p>
<p id="p1578414553451"><a id="p1578414553451"></a><a id="p1578414553451"></a>YUV422Packed: The result of (Width of the image active area x 2) is 128-pixel aligned.</p>
<p id="p16791145513455"><a id="p16791145513455"></a><a id="p16791145513455"></a>YUV444Packed and RGB888: The result of (Width of the image active area x 3) is 128-pixel aligned.</p>
<p id="p117961855154516"><a id="p117961855154516"></a><a id="p117961855154516"></a>XRGB8888: The result of (Width of the image active area x 4) is 128-pixel aligned.</p>
<p id="p635064420232"><a id="p635064420232"></a><a id="p635064420232"></a>When the input format is HFBC, enter the image width.</p>
</td>
</tr>
<tr id="row12956639"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p34399100474"><a id="p34399100474"></a><a id="p34399100474"></a>uint32_t heightStride</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p48691998"><a id="p48691998"></a><a id="p48691998"></a>Height stride. For YUV SP images, you can use this parameter to calculate the start address of UV data.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p920351710481"><a id="p920351710481"></a><a id="p920351710481"></a>--</p>
</td>
</tr>
<tr id="row30010351"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p14919362"><a id="p14919362"></a><a id="p14919362"></a>enum VpcInputFormat inputFormat</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p508818"><a id="p508818"></a><a id="p508818"></a>Input image format</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p379201413492"><a id="p379201413492"></a><a id="p379201413492"></a>enum VpcInputFormat {</p>
<p id="p146964794915"><a id="p146964794915"></a><a id="p146964794915"></a>INPUT_YUV400, // 0</p>
<p id="p1085310355218"><a id="p1085310355218"></a><a id="p1085310355218"></a>INPUT_YUV420_SEMI_PLANNER_UV, // 1</p>
<p id="p1133911955319"><a id="p1133911955319"></a><a id="p1133911955319"></a>INPUT_YUV420_SEMI_PLANNER_VU, // 2</p>
<p id="p2026164825316"><a id="p2026164825316"></a><a id="p2026164825316"></a>INPUT_YUV422_SEMI_PLANNER_UV, // 3</p>
<p id="p1849434155411"><a id="p1849434155411"></a><a id="p1849434155411"></a>INPUT_YUV422_SEMI_PLANNER_VU, // 4</p>
<p id="p16547161212547"><a id="p16547161212547"></a><a id="p16547161212547"></a>INPUT_YUV444_SEMI_PLANNER_UV, // 5</p>
<p id="p15294191544"><a id="p15294191544"></a><a id="p15294191544"></a>INPUT_YUV444_SEMI_PLANNER_VU, // 6</p>
<p id="p2697202585411"><a id="p2697202585411"></a><a id="p2697202585411"></a>INPUT_YUV422_PACKED_YUYV, // 7</p>
<p id="p2023213337544"><a id="p2023213337544"></a><a id="p2023213337544"></a>INPUT_YUV422_PACKED_UYVY, // 8</p>
<p id="p690514388546"><a id="p690514388546"></a><a id="p690514388546"></a>INPUT_YUV422_PACKED_YVYU, // 9</p>
<p id="p8349464545"><a id="p8349464545"></a><a id="p8349464545"></a>INPUT_YUV422_PACKED_VYUY, // 10</p>
<p id="p1960545485410"><a id="p1960545485410"></a><a id="p1960545485410"></a>INPUT_YUV444_PACKED_YUV, // 11</p>
<p id="p67391919551"><a id="p67391919551"></a><a id="p67391919551"></a>INPUT_RGB, // 12</p>
<p id="p102021422145517"><a id="p102021422145517"></a><a id="p102021422145517"></a>INPUT_BGR, // 13</p>
<p id="p264102955514"><a id="p264102955514"></a><a id="p264102955514"></a>INPUT_ARGB, // 14</p>
<p id="p918453555512"><a id="p918453555512"></a><a id="p918453555512"></a>INPUT_ABGR, // 15</p>
<p id="p11855184045513"><a id="p11855184045513"></a><a id="p11855184045513"></a>INPUT_RGBA, // 16</p>
<p id="p8231547135517"><a id="p8231547135517"></a><a id="p8231547135517"></a>INPUT_BGRA, // 17</p>
<p id="p1420215325519"><a id="p1420215325519"></a><a id="p1420215325519"></a>INPUT_YUV420_SEMI_PLANNER_UV_10BIT, // 18</p>
<p id="p1187017013564"><a id="p1187017013564"></a><a id="p1187017013564"></a>INPUT_YUV420_SEMI_PLANNER_VU_10BIT, // 19</p>
<p id="p1980131416491"><a id="p1980131416491"></a><a id="p1980131416491"></a>};</p>
</td>
</tr>
<tr id="row33408077"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p1297522585618"><a id="p1297522585618"></a><a id="p1297522585618"></a>enum VpcOutputFormat outputFormat</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p1191617185710"><a id="p1191617185710"></a><a id="p1191617185710"></a>Output image format</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p19902194214577"><a id="p19902194214577"></a><a id="p19902194214577"></a>enum VpcOutputFormat {</p>
<p id="p0990192011588"><a id="p0990192011588"></a><a id="p0990192011588"></a>OUTPUT_YUV420SP_UV,</p>
<p id="p119021142185717"><a id="p119021142185717"></a><a id="p119021142185717"></a>OUTPUT_YUV420SP_VU</p>
<p id="p15902134216575"><a id="p15902134216575"></a><a id="p15902134216575"></a>};</p>
</td>
</tr>
<tr id="row38211534"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p8126535"><a id="p8126535"></a><a id="p8126535"></a>VpcUserRoiConfigure* roiConfigure</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p54269597"><a id="p54269597"></a><a id="p54269597"></a>Cropped area configuration. For details, see <a href="structures-in-vpcuserimageconfigure.html#li491075611222">VpcUserRoiConfigure</a>.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p968413511221"><a id="p968413511221"></a><a id="p968413511221"></a>--</p>
</td>
</tr>
<tr id="row49995190"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p23078612"><a id="p23078612"></a><a id="p23078612"></a>bool isCompressData</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p57428258"><a id="p57428258"></a><a id="p57428258"></a>Whether the data format of the compressed image output by the VDEC is used</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p61494210216"><a id="p61494210216"></a><a id="p61494210216"></a>When the image comes from the VDEC, set this parameter to<strong> true</strong>. For other image formats, set this parameter to <strong>false</strong>. The default value is <strong>false</strong>.</p>
</td>
</tr>
<tr id="row3204586"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p58244917"><a id="p58244917"></a><a id="p58244917"></a>VpcCompressDataConfigure compressDataConfigure</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p20217812"><a id="p20217812"></a><a id="p20217812"></a>Data configuration of the compressed image output by the VDEC. For details, see <a href="structures-in-vpcuserimageconfigure.html#li145621262363">VpcCompressDataConfigur...</a>.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p157241027161"><a id="p157241027161"></a><a id="p157241027161"></a>--</p>
</td>
</tr>
<tr id="row158091341465"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p1081012341565"><a id="p1081012341565"></a><a id="p1081012341565"></a>bool yuvSumEnable</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p2081016341768"><a id="p2081016341768"></a><a id="p2081016341768"></a>Whether to calculate the yuvSum value. The AI core has this requirement. When the yuvSum value needs to be calculated, only the mode of one ROI per image is supported.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p881119341618"><a id="p881119341618"></a><a id="p881119341618"></a>When the yuvSum value needs to be calculated, set this parameter to <strong>true</strong>. Otherwise, set this parameter to <strong>false</strong>. The default value is <strong>false</strong>.</p>
</td>
</tr>
<tr id="row599641217268"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p99969127266"><a id="p99969127266"></a><a id="p99969127266"></a>VpcUserYuvSum yuvSum</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p1999618127266"><a id="p1999618127266"></a><a id="p1999618127266"></a>yuvSum calculation configuration. For details, see <a href="structures-in-vpcuserimageconfigure.html#li199955303388">VpcUserYuvSum</a>.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p9996112102613"><a id="p9996112102613"></a><a id="p9996112102613"></a>--</p>
</td>
</tr>
<tr id="row1684292141211"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p3842152119129"><a id="p3842152119129"></a><a id="p3842152119129"></a>VpcUserPerformanceTuningParameter tuningParameter</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p984222191219"><a id="p984222191219"></a><a id="p984222191219"></a>Reserved for parameter optimization. For details, see <a href="structures-in-vpcuserimageconfigure.html#li1672210436433">VpcUserPerformanceTunin...</a>.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p14842021101212"><a id="p14842021101212"></a><a id="p14842021101212"></a>--</p>
</td>
</tr>
<tr id="row1096213433139"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p14962154301317"><a id="p14962154301317"></a><a id="p14962154301317"></a>uint32_t* cmdListBufferAddr</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p189621343151313"><a id="p189621343151313"></a><a id="p189621343151313"></a>Reserved</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p19621743181319"><a id="p19621743181319"></a><a id="p19621743181319"></a>--</p>
</td>
</tr>
<tr id="row152914661312"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p13529194681318"><a id="p13529194681318"></a><a id="p13529194681318"></a>uint32_t cmdListBufferSize</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p0530194612139"><a id="p0530194612139"></a><a id="p0530194612139"></a>Reserved</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p85308466133"><a id="p85308466133"></a><a id="p85308466133"></a>--</p>
</td>
</tr>
<tr id="row9734726171417"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p17343264143"><a id="p17343264143"></a><a id="p17343264143"></a>uint64_t yuvScalerParaSetAddr</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p3734152661412"><a id="p3734152661412"></a><a id="p3734152661412"></a>Array for the path address of the parameter set file and the file name</p>
<div class="note" id="note16931928101712"><a id="note16931928101712"></a><a id="note16931928101712"></a><span class="notetitle"> NOTE: </span><div class="notebody"><a id="ul122661540104712"></a><a id="ul122661540104712"></a><ul id="ul122661540104712"><li>The parameter set must be on the device.</li><li>Ensure that the transferred file path is correct.</li></ul>
</div></div>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p16295810151717"><a id="p16295810151717"></a><a id="p16295810151717"></a>The path of the parameter set file consists of the absolute file path on the device and the file name, for example, {&quot;/root/share/vpc/YUVScaler_pra.h&quot;}.</p>
</td>
</tr>
<tr id="row46361639141512"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p13871184071819"><a id="p13871184071819"></a><a id="p13871184071819"></a>uint16_t yuvScalerParaSetSize</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p16870174012182"><a id="p16870174012182"></a><a id="p16870174012182"></a>Number of elements in the parameter set array to which the parameter set address points. The default value is <strong>1</strong>.</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p1655734419199"><a id="p1655734419199"></a><a id="p1655734419199"></a>1&lt;=yuvscaler_paraset_size&lt;=10</p>
</td>
</tr>
<tr id="row19354234201"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p17936823182016"><a id="p17936823182016"></a><a id="p17936823182016"></a>uint16_t yuvScalerParaSetIndex</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p7293042142017"><a id="p7293042142017"></a><a id="p7293042142017"></a>Index of yuvScalerParaSetAddr (The default value is <strong>0</strong>.)</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p1293622318206"><a id="p1293622318206"></a><a id="p1293622318206"></a>0&lt;=yuvScalerParaSetIndex&lt;10</p>
</td>
</tr>
<tr id="row14629227121619"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.1.4.1.1 "><p id="p191902156221"><a id="p191902156221"></a><a id="p191902156221"></a>uint32_t reserve1</p>
</td>
<td class="cellrowborder" valign="top" width="42.39%" headers="mcps1.1.4.1.2 "><p id="p1018811157225"><a id="p1018811157225"></a><a id="p1018811157225"></a>Reserved</p>
</td>
<td class="cellrowborder" valign="top" width="38.61%" headers="mcps1.1.4.1.3 "><p id="p418715151229"><a id="p418715151229"></a><a id="p418715151229"></a>--</p>
</td>
</tr>
</tbody>
</table>

<p>For the syntax of the preceding APIs, see<strong> include/inc/dvpp/Vpc.h</strong>  in the DDK package. The details are as follows:</p>
<pre><code>// Supported input formats
enum VpcInputFormat {
    INPUT_YUV400, // 0
    INPUT_YUV420_SEMI_PLANNER_UV, // 1
    INPUT_YUV420_SEMI_PLANNER_VU, // 2
    INPUT_YUV422_SEMI_PLANNER_UV, // 3
    INPUT_YUV422_SEMI_PLANNER_VU, // 4
    INPUT_YUV444_SEMI_PLANNER_UV, // 5
    INPUT_YUV444_SEMI_PLANNER_VU, // 6
    INPUT_YUV422_PACKED_YUYV, // 7
    INPUT_YUV422_PACKED_UYVY, // 8
    INPUT_YUV422_PACKED_YVYU, // 9
    INPUT_YUV422_PACKED_VYUY, // 10
    INPUT_YUV444_PACKED_YUV, // 11
    INPUT_RGB, // 12
    INPUT_BGR, // 13
    INPUT_ARGB, // 14
    INPUT_ABGR, // 15
    INPUT_RGBA, // 16
    INPUT_BGRA, // 17
    INPUT_YUV420_SEMI_PLANNER_UV_10BIT, // 18
    INPUT_YUV420_SEMI_PLANNER_VU_10BIT, // 19
};
// Supported output formats
enum VpcOutputFormat {
    OUTPUT_YUV420SP_UV,
    OUTPUT_YUV420SP_VU
};
// Data configuration in compressed format
struct VpcCompressDataConfigure
{
    uint64_t lumaHeadAddr;  
    uint64_t chromaHeadAddr; 
    uint32_t lumaHeadStride;
    uint32_t chromaHeadStride;
    uint64_t lumaPayloadAddr;  
    uint64_t chromaPayloadAddr;
    uint32_t lumaPayloadStride;
    uint32_t chromaPayloadStride;
    VpcCompressDataConfigure()
    {
        lumaHeadAddr = 0;
        chromaHeadAddr = 0;
        lumaHeadStride = 0;
        chromaHeadStride = 0;
        lumaPayloadAddr = 0;
        chromaPayloadAddr = 0;
        lumaPayloadStride = 0;
        chromaPayloadStride = 0;
    }
};
// Configuration of the cropped area
struct VpcUserCropConfigure {
   uint32_t leftOffset; // Left offset
   uint32_t rightOffset; // Right offset
    uint32_t upOffset; // Up offset
    uint32_t downOffset; // Down offset
    uint64_t reserve1;
    VpcUserCropConfigure()
    {
        leftOffset = 0;
        rightOffset = 0;
        upOffset = 0;
        downOffset = 0;
    }
};
// The AI core has this requirement. The total amount of each component for the output YUV image needs to be calculated.
struct VpcUserYuvSum {
    uint32_t ySum;
    uint32_t uSum;
    uint32_t vSum;
    uint64_t reserve1;
    VpcUserYuvSum()
    {
        ySum = 0;
        uSum = 0;
        vSum = 0;
    }
};
// Configuration of the input data for the area cropped by the user
struct VpcUserRoiInputConfigure {
    VpcUserCropConfigure cropArea;
    uint64_t reserve1;
};
// Configuration of the output data for the area cropped by the user
struct VpcUserRoiOutputConfigure {
    uint8_t * addr; // Start address of the output image
    uint32_t bufferSize; // Size of the output buffer, calculated based on YUV420sp.
    uint32_t widthStride; // Width stride of the output image
    uint32_t heightStride; // Height stride of the output YUV420sp image, which can be used to calculate the start address of the UV data
// Coordinates of the output area specified by the user
    VpcUserCropConfigure outputArea;
    uint64_t reserve1;
    VpcUserRoiOutputConfigure()
    {
        addr = 0;
        bufferSize = 0;
        widthStride = 0;
        heightStride = 0;
    }
};
struct VpcUserRoiConfigure {
    VpcUserRoiInputConfigure inputConfigure;
    VpcUserRoiOutputConfigure outputConfigure;
    VpcUserRoiConfigure* next; 
    uint64_t reserve1;
    VpcUserRoiConfigure () 
    {
        next = nullptr;
    }
};
// Reserved for performance optimization
struct VpcUserPerformanceTuningParameter{
    uint64_t reserve1;
    uint64_t reserve2;
    uint64_t reserve3;
    uint64_t reserve4;
    uint64_t reserve5;
};
// Configuration for the user to invoke the VPC
struct VpcUserImageConfigure {
    uint8_t* bareDataAddr; // Address of the input image in uncompressed format. When the input image is in compressed format, this parameter does not need to be set.
    uint32_t bareDataBufferSize; // Buffer size, which is calculated based on the width and height of the image. If the image is in compressed format, this parameter does not need to be set.
    uint32_t widthStride; // Width stride, which is used to calculate the address of the next line of image. The ratio of stride to width varies with the image format.
    uint32_t heightStride; // Height stride, which is used to calculate the start address of the UV data if the image is in YUV semi-planar format.
enum VpcInputFormat inputFormat;
enum VpcOutputFormat outputFormat;
   VpcUserRoiConfigure* roiConfigure; // Configuration of the cropped area. The mode of multiple ROIs per image is supported.
//Data configuration of HFBC compressed input images. Multiple values need to be set for the compressed image data. The source is the VDEC module.
bool isCompressData;
    VpcCompressDataConfigure compressDataConfigure;
// The AI core has the requirement for calculating the total amount of each component of the output image. In this case, only the mode of one ROI per image is supported.
// If you want to obtain the yuvSum value, set yuvSumEnable to true.
bool yuvSumEnable; // If the yuvSum value is not required, this parameter does not need to be set. The default value is false.
    VpcUserYuvSum yuvSum;

    VpcUserPerformanceTuningParameter tuningParameter;//// Reserved for parameter optimization
    uint32_t* cmdListBufferAddr; // Reserved
   uint32_t cmdListBufferSize; // Reserved
    uint64_t reserve1;
    uint64_t reserve2;
    VpcUserImageConfigure()
    {
        bareDataAddr = nullptr;
        bareDataBufferSize = 0;
        widthStride = 0;
        heightStride = 0;
        inputFormat = INPUT_YUV420_SEMI_PLANNER_UV;
        outputFormat = OUTPUT_YUV420SP_UV;
        roiConfigure = nullptr;
        isCompressData = false;
        yuvSumEnable = false;
        cmdListBufferAddr = nullptr;
        cmdListBufferSize = 0;
    }
};
</code></pre><h2 id="output-parameters">Output Parameters<a id="section13203121185013"></a></h2>
<p>None</p>
<h2 id="restrictions">Restrictions<a id="section115236359362"></a></h2>
<ul>
<li>The width and height of the active area of the original image must be even numbers.</li>
<li>Except 8K scaling: The minimum resolution for the cropped and overridden areas is 16 x 16, while the maximum resolution is 4096 x 4096.</li>
<li>8 KB scaling: The resolution supports up to 4096 x 4096&#x2013;8192 x 8192. The only supported format is YUV420. The output resolution supports 16 x 16&#x2013;4096 x 4096. In addition, 8K does not require respective 128-byte and 16-byte alignment of the image width and height strides, but 2-byte and 2-byte alignment instead.</li>
<li>For the cropped area, the left offset and upper offset are even numbers, while the right offset and lower offset are odd numbers. This restriction is the same as that on the old API. The restrictions on the overridden area are the same. That is, the left offset and upper offset are even numbers, while the right offset and lower offset are odd numbers.</li>
<li>The cropped area cannot be larger than the input image, and the overridden area cannot be larger than the output image.</li>
<li><p>The left offset of the overridden area relative to the output image is 16-byte aligned.</p>
<blockquote>
<p><img src="public_sys-resources/icon-note.gif" alt=""> <strong>NOTE:</strong><br>The overridden area can be directly mapped on the leftmost side of the output image, that is, the left offset of the output image is  <strong>0</strong>. For details, see  <a href="#fig15358550161512">Figure 1</a>.  </p>
</blockquote>
</li>
<li><p>The width stride of the input/output image is 128-pixel aligned, and the height stride 16-pixel aligned. The maximum width stride is the maximum resolution of an ARGB image multiplied by 4, that is, 4096 x 4.</p>
</li>
<li>The buffer addresses of the input and output images are in the same 4 GB space. The first address is 128-byte aligned.</li>
<li>Scaling range of the width and height: [1/32, 16]</li>
<li>The maximum number of overridden areas is 256.</li>
</ul>
<h2 id="calling-example">Calling Example<a id="section162521711183414"></a></h2>
<p>Example 1: Scaling of the original image</p>
<pre><code>void nevVpcTest1()
{
    int32_t ret = 0;
    uint32_t inWidthStride = 1920;
    uint32_t inHeightStride = 1088;
    uint32_t outWidthStride = 1280;
    uint32_t outHeightStride = 720;
    uint32_t inBufferSize = inWidthStride * inHeightStride * 3 / 2; // 1080p YUV420sp image
    uint32_t outBufferSize = outWidthStride * outHeightStride * 3 / 2; // 720p YUV420sp image
// Construct pseudo data.
   uint8_t* inBuffer = (uint8_t*)HIAI_DMalloc(inBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE); // Construct an input image.
    uint8_t* outBuffer = (uint8_t*)HIAI_DMalloc(outBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE);// Construct an output image.
// Construct the configuration of the input image.
    std::shared_ptr&lt;VpcUserImageConfigure&gt; imageConfigure(new VpcUserImageConfigure);
    imageConfigure-&gt;bareDataAddr = inBuffer;
    imageConfigure-&gt;bareDataBufferSize = inBufferSize;
    imageConfigure-&gt;isCompressData = false;
    imageConfigure-&gt;widthStride = inWidthStride;
    imageConfigure-&gt;heightStride = inHeightStride;
    imageConfigure-&gt;inputFormat = INPUT_YUV420_SEMI_PLANNER_UV;
    imageConfigure-&gt;outputFormat = OUTPUT_YUV420SP_UV;
    imageConfigure-&gt;yuvSumEnable = false;
    imageConfigure-&gt;cmdListBufferAddr = nullptr;
    imageConfigure-&gt;cmdListBufferSize = 0;
    std::shared_ptr&lt;VpcUserRoiConfigure&gt; roiConfigure(new VpcUserRoiConfigure);
    roiConfigure-&gt;next = nullptr;
    VpcUserRoiInputConfigure* inputConfigure = &amp;roiConfigure-&gt;inputConfigure;
// Set the cropped area, with the coordinates [0, 0] in the upper left corner and the coordinates [1919, 1079] in the lower right corner.
    inputConfigure-&gt;cropArea.leftOffset  = 0;
    inputConfigure-&gt;cropArea.rightOffset = 1919;
    inputConfigure-&gt;cropArea.upOffset    = 0;
    inputConfigure-&gt;cropArea.downOffset  = 1079;
    VpcUserRoiOutputConfigure* outputConfigure = &amp;roiConfigure-&gt;outputConfigure;
    outputConfigure-&gt;addr = outBuffer;
    outputConfigure-&gt;bufferSize = outBufferSize;
    outputConfigure-&gt;widthStride = outWidthStride;
    outputConfigure-&gt;heightStride = outHeightStride;
// Set the cropped area, with the coordinates [0, 0] in the upper left corner and the coordinates [1279, 719] in the lower right corner.
    outputConfigure-&gt;outputArea.leftOffset  = 0;
    outputConfigure-&gt;outputArea.rightOffset = 1279;
    outputConfigure-&gt;outputArea.upOffset    = 0;
    outputConfigure-&gt;outputArea.downOffset  = 719;
    imageConfigure-&gt;roiConfigure = roiConfigure.get();

    IDVPPAPI *pidvppapi = nullptr;
    ret = CreateDvppApi(pidvppapi);
if (ret != 0) {
        printf(&quot;create dvpp api fail.\n&quot;);
        UNMAP(inBuffer, inBufferSize);
        UNMAP(outBuffer, outBufferSize);
return;
    }
    dvppapi_ctl_msg dvppApiCtlMsg;
    dvppApiCtlMsg.in = static_cast&lt;void*&gt;(imageConfigure.get());
    dvppApiCtlMsg.in_size = sizeof(VpcUserImageConfigure);
    ret = DvppCtl(pidvppapi, DVPP_CTL_VPC_PROC, &amp;dvppApiCtlMsg);
if (0 != ret) {
        printf(&quot;call vpc dvppctl process faild!\n&quot;);
        ret = DestroyDvppApi(pidvppapi);
return;
    } else {
        printf(&quot;call vpc dvppctl process success!\n&quot;);
    }
    ret = DestroyDvppApi(pidvppapi);
    UNMAP(inBuffer, inBufferSize);
    UNMAP(outBuffer, outBufferSize);
return;
}
</code></pre><p>Example 2: Scaling of the cropped area. The result is output to the specified position of the output image.</p>
<pre><code>void nevVpcTest2()
{
    int32_t ret = 0;
    uint32_t inWidthStride = 1920;
    uint32_t inHeightStride = 1080;
    uint32_t outWidthStride = 1280;
    uint32_t outHeightStride = 720;
    uint32_t inBufferSize = inWidthStride * inHeightStride * 3 / 2; // 1080p YUV420sp image
    uint32_t outBufferSize = outWidthStride * outHeightStride * 3 / 2; // 720p YUV420sp image
// Construct pseudo data.
   uint8_t* inBuffer = (uint8_t*)HIAI_DMalloc(inBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE); // Construct an input image.
    uint8_t* outBuffer = (uint8_t*)HIAI_DMalloc(outBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE); // Construct an output image.
// Construct the configuration of the input image.
    std::shared_ptr&lt;VpcUserImageConfigure&gt; imageConfigure(new VpcUserImageConfigure);
    imageConfigure-&gt;bareDataAddr = inBuffer;
    imageConfigure-&gt;bareDataBufferSize = inBufferSize;
    imageConfigure-&gt;isCompressData = false;
    imageConfigure-&gt;widthStride = inWidthStride;
    imageConfigure-&gt;heightStride = inHeightStride;
    imageConfigure-&gt;inputFormat = INPUT_YUV420_SEMI_PLANNER_UV;
    imageConfigure-&gt;outputFormat = OUTPUT_YUV420SP_UV;
    imageConfigure-&gt;yuvSumEnable = false;
    imageConfigure-&gt;cmdListBufferAddr = nullptr;
    imageConfigure-&gt;cmdListBufferSize = 0;
    std::shared_ptr&lt;VpcUserRoiConfigure&gt; roiConfigure(new VpcUserRoiConfigure);
    roiConfigure-&gt;next = nullptr;
    VpcUserRoiInputConfigure* inputConfigure = &amp;roiConfigure-&gt;inputConfigure;
// Set the cropped area, with the coordinates [100, 100] in the upper left corner and the coordinates [499, 499] in the lower right corner.
    inputConfigure-&gt;cropArea.leftOffset  = 100;
    inputConfigure-&gt;cropArea.rightOffset = 499;
    inputConfigure-&gt;cropArea.upOffset    = 100;
    inputConfigure-&gt;cropArea.downOffset  = 499;
    VpcUserRoiOutputConfigure* outputConfigure = &amp;roiConfigure-&gt;outputConfigure;
    outputConfigure-&gt;addr = outBuffer;
    outputConfigure-&gt;bufferSize = outBufferSize;
    outputConfigure-&gt;widthStride = outWidthStride;
    outputConfigure-&gt;heightStride = outHeightStride;
// Set the overridden area, with the coordinates [256,200] in the upper left corner and the coordinates [399,399] in the lower right corner.
   outputConfigure-&gt;outputArea.leftOffset = 256; // The offset value must be 16-byte aligned.
    outputConfigure-&gt;outputArea.rightOffset = 399;
    outputConfigure-&gt;outputArea.upOffset    = 200;
    outputConfigure-&gt;outputArea.downOffset  = 399;
    imageConfigure-&gt;roiConfigure = roiConfigure.get();

    IDVPPAPI *pidvppapi = nullptr;
    ret = CreateDvppApi(pidvppapi);
if (ret != 0) {
        printf(&quot;create dvpp api fail.\n&quot;);
        UNMAP(inBuffer, inBufferSize);
        UNMAP(outBuffer, outBufferSize);
return;
    }
    dvppapi_ctl_msg dvppApiCtlMsg;
    dvppApiCtlMsg.in = static_cast&lt;void*&gt;(imageConfigure.get());
    dvppApiCtlMsg.in_size = sizeof(VpcUserImageConfigure);
    ret = DvppCtl(pidvppapi, DVPP_CTL_VPC_PROC, &amp;dvppApiCtlMsg);
if (0 != ret) {
        printf(&quot;call vpc dvppctl process faild!\n&quot;);
        ret = DestroyDvppApi(pidvppapi);
return;
    } else {
        printf(&quot;call vpc dvppctl process success!\n&quot;);
    }
    ret = DestroyDvppApi(pidvppapi);
    UNMAP(inBuffer, inBufferSize);
    UNMAP(outBuffer, outBufferSize);
return;
}
</code></pre><p>Example 3: Cropping of multiple images</p>
<pre><code>void nevVpcTest3(int&amp; ret)
{
    int32_t ret = 0;
    uint32_t inWidthStride = 1920;
    uint32_t inHeightStride = 1080;
    uint32_t outWidthStride = 1280;
    uint32_t outHeightStride = 720;
    uint32_t inBufferSize = inWidthStride * inHeightStride * 3 / 2; // 1080p YUV420sp image
    uint32_t outBufferSize = outWidthStride * outHeightStride * 3 / 2; // 720p YUV420sp image
// Construct pseudo data.
    uint8_t* inBuffer = (uint8_t*)HIAI_DMalloc(inBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE);// Construct an input image.
// Construct the configuration of the input image.
    std::shared_ptr&lt;VpcUserImageConfigure&gt; imageConfigure(new VpcUserImageConfigure);
    imageConfigure-&gt;bareDataAddr = inBuffer;
    imageConfigure-&gt;bareDataBufferSize = inBufferSize;
    imageConfigure-&gt;isCompressData = false;
    imageConfigure-&gt;widthStride = inWidthStride;
    imageConfigure-&gt;heightStride = inHeightStride;
    imageConfigure-&gt;inputFormat = INPUT_YUV420_SEMI_PLANNER_UV;
    imageConfigure-&gt;outputFormat = OUTPUT_YUV420SP_UV;
    imageConfigure-&gt;yuvSumEnable = false;
    imageConfigure-&gt;cmdListBufferAddr = nullptr;
    imageConfigure-&gt;cmdListBufferSize = 0;
    std::shared_ptr&lt;VpcUserRoiConfigure&gt; lastRoi;
for (int i = 0; i &lt; 5; i++) {
        std::shared_ptr&lt;VpcUserRoiConfigure&gt; roiConfigure(new VpcUserRoiConfigure);
        roiConfigure-&gt;next = nullptr;
        VpcUserRoiInputConfigure* inputConfigure = &amp;roiConfigure-&gt;inputConfigure;
// Set the cropped area.
        inputConfigure-&gt;cropArea.leftOffset  = 100 + i * 16;
        inputConfigure-&gt;cropArea.rightOffset = 499 + i * 16;
        inputConfigure-&gt;cropArea.upOffset    = 100 + i * 16;
        inputConfigure-&gt;cropArea.downOffset  = 499 + i * 16;
        VpcUserRoiOutputConfigure* outputConfigure = &amp;roiConfigure-&gt;outputConfigure;
        uint8_t* outBuffer = (uint8_t*)HIAI_DMalloc(outBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE);//  Construct an output image.
        outputConfigure-&gt;addr = outBuffer;
        outputConfigure-&gt;bufferSize = outBufferSize;
        outputConfigure-&gt;widthStride = outWidthStride;
        outputConfigure-&gt;heightStride = outHeightStride;
// Set the overridden area.
        outputConfigure-&gt;outputArea.leftOffset  = 256 + i * 16; // The offset value must be 16-byte aligned.
        outputConfigure-&gt;outputArea.rightOffset = 399 + i * 16;
        outputConfigure-&gt;outputArea.upOffset    = 399 + i * 16;
        outputConfigure-&gt;outputArea.downOffset  = 399 + i * 16;
if (i == 0) {
            imageConfigure-&gt;roiConfigure = roiConfigure.get();
            lastRoi = roiConfigure;
        } else {
            lastRoi-&gt;next = roiConfigure.get();
            lastRoi = roiConfigure;
        }
    }

    IDVPPAPI *pidvppapi = nullptr;
    ret = CreateDvppApi(pidvppapi);
if (ret != 0) {
        printf(&quot;create dvpp api fail.\n&quot;);
        UNMAP(inBuffer, inBufferSize);
while (imageConfigure-&gt;roiConfigure != nullptr) {
            UNMAP(imageConfigure-&gt;roiConfigure-&gt;outputConfigure.addr, outBufferSize);
            imageConfigure-&gt;roiConfigure = imageConfigure-&gt;roiConfigure-&gt;next;
        }         
return;
    }
    dvppapi_ctl_msg dvppApiCtlMsg;
    dvppApiCtlMsg.in = static_cast&lt;void*&gt;(imageConfigure.get());
    dvppApiCtlMsg.in_size = sizeof(VpcUserImageConfigure);
    ret = DvppCtl(pidvppapi, DVPP_CTL_VPC_PROC, &amp;dvppApiCtlMsg);
if (0 != ret) {
        printf(&quot;call vpc dvppctl process faild!\n&quot;);
        ret = DestroyDvppApi(pidvppapi);
return;
    } else {
        printf(&quot;call vpc dvppctl process success!\n&quot;);
    }
    ret = DestroyDvppApi(pidvppapi);
    UNMAP(inBuffer, inBufferSize);
while (imageConfigure-&gt;roiConfigure != nullptr) {
        UNMAP(imageConfigure-&gt;roiConfigure-&gt;outputConfigure.addr, outBufferSize);
        imageConfigure-&gt;roiConfigure = imageConfigure-&gt;roiConfigure-&gt;next;
    }
return;
}
</code></pre><p>Example 4: 8K scaling, 8129 x 8192 scaled to 4000 x 4000</p>
<pre><code>void nevVpcTest4()
{
    int32_t ret = 0;
    uint32_t inWidthStride = 8192; // 128-byte alignment is not required.
    uint32_t inHeightStride = 8192; // 16-byte alignment is not required.
    uint32_t outWidthStride = 4000; // 128-byte alignment is not required.
   uint32_t outHeightStride = 4000; // 16-byte alignment is not required.
    uint32_t inBufferSize = inWidthStride * inHeightStride * 3 / 2;     uint32_t outBufferSize = outWidthStride * outHeightStride * 3 / 2; 
// Construct pseudo data.
   uint8_t* inBuffer = (uint8_t*)HIAI_DMalloc(inBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE); // Construct an input image.
    uint8_t* outBuffer = (uint8_t*)HIAI_DMalloc(outBufferSize, MALLOC_DEFAULT_TIME_OUT, HIAI_MEMORY_HUGE_PAGE);// Construct an output image.
// Construct the configuration of the input image.
    std::shared_ptr&lt;VpcUserImageConfigure&gt; imageConfigure(new VpcUserImageConfigure);
    imageConfigure-&gt;bareDataAddr = inBuffer;
    imageConfigure-&gt;bareDataBufferSize = inBufferSize;
    imageConfigure-&gt;isCompressData = false;
    imageConfigure-&gt;widthStride = inWidthStride;
    imageConfigure-&gt;heightStride = inHeightStride;
    imageConfigure-&gt;inputFormat = INPUT_YUV420_SEMI_PLANNER_UV;
    imageConfigure-&gt;outputFormat = OUTPUT_YUV420SP_UV;
    imageConfigure-&gt;yuvSumEnable = false;
    imageConfigure-&gt;cmdListBufferAddr = nullptr;
    imageConfigure-&gt;cmdListBufferSize = 0;
    std::shared_ptr&lt;VpcUserRoiConfigure&gt; roiConfigure(new VpcUserRoiConfigure);
    roiConfigure-&gt;next = nullptr;
    VpcUserRoiInputConfigure* inputConfigure = &amp;roiConfigure-&gt;inputConfigure;
// Set the cropped area.
    inputConfigure-&gt;cropArea.leftOffset  = 0;
    inputConfigure-&gt;cropArea.rightOffset = 8191;
    inputConfigure-&gt;cropArea.upOffset    = 0;
    inputConfigure-&gt;cropArea.downOffset  = 8191;
    VpcUserRoiOutputConfigure* outputConfigure = &amp;roiConfigure-&gt;outputConfigure;
    outputConfigure-&gt;addr = outBuffer;
    outputConfigure-&gt;bufferSize = outBufferSize;
    outputConfigure-&gt;widthStride = outWidthStride;
    outputConfigure-&gt;heightStride = outHeightStride;
// Set the overridden area.
    outputConfigure-&gt;outputArea.leftOffset  = 0;
    outputConfigure-&gt;outputArea.rightOffset = 3999;
    outputConfigure-&gt;outputArea.upOffset    = 0;
    outputConfigure-&gt;outputArea.downOffset  = 3999;
    imageConfigure-&gt;roiConfigure = roiConfigure.get();

    IDVPPAPI *pidvppapi = nullptr;
    ret = CreateDvppApi(pidvppapi);
if (ret != 0) {
        printf(&quot;create dvpp api fail.\n&quot;);
        UNMAP(inBuffer, inBufferSize);
        UNMAP(outBuffer, outBufferSize);
return;
    }
    dvppapi_ctl_msg dvppApiCtlMsg;
    dvppApiCtlMsg.in = static_cast&lt;void*&gt;(imageConfigure.get());
    dvppApiCtlMsg.in_size = sizeof(VpcUserImageConfigure);
    ret = DvppCtl(pidvppapi, DVPP_CTL_VPC_PROC, &amp;dvppApiCtlMsg);
if (0 != ret) {
        printf(&quot;call vpc dvppctl process faild!\n&quot;);
        ret = DestroyDvppApi(pidvppapi);
return;
    } else {
        printf(&quot;call vpc dvppctl process success!\n&quot;);
    }
    ret = DestroyDvppApi(pidvppapi);
    UNMAP(inBuffer, inBufferSize);
    UNMAP(outBuffer, outBufferSize);
return;
}
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="dvppctl.html" class="navigation navigation-prev " aria-label="Previous page: DvppCtl">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="old-vpc-api.html" class="navigation navigation-next " aria-label="Next page: Old VPC API">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"New VPC API ","level":"1.3.2.1","depth":3,"next":{"title":"Old VPC API","level":"1.3.2.2","depth":3,"path":"old-vpc-api.md","ref":"old-vpc-api.md","articles":[]},"previous":{"title":"DvppCtl","level":"1.3.2","depth":2,"path":"dvppctl.md","ref":"dvppctl.md","articles":[{"title":"New VPC API ","level":"1.3.2.1","depth":3,"path":"new-vpc-api.md","ref":"new-vpc-api.md","articles":[]},{"title":"Old VPC API","level":"1.3.2.2","depth":3,"path":"old-vpc-api.md","ref":"old-vpc-api.md","articles":[]},{"title":"CMDLIST","level":"1.3.2.3","depth":3,"path":"cmdlist.md","ref":"cmdlist.md","articles":[]},{"title":"VDEC","level":"1.3.2.4","depth":3,"path":"vdec.md","ref":"vdec.md","articles":[]},{"title":"JPEGE","level":"1.3.2.5","depth":3,"path":"jpege.md","ref":"jpege.md","articles":[]},{"title":"JPEGD","level":"1.3.2.6","depth":3,"path":"jpegd.md","ref":"jpegd.md","articles":[]},{"title":"PNGD","level":"1.3.2.7","depth":3,"path":"pngd.md","ref":"pngd.md","articles":[]},{"title":"VENC","level":"1.3.2.8","depth":3,"path":"venc.md","ref":"venc.md","articles":[]},{"title":"Querying DVPP Engine Capabilities","level":"1.3.2.9","depth":3,"path":"querying-dvpp-engine-capabilities.md","ref":"querying-dvpp-engine-capabilities.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"imgUrl":"","topnav":[]},"plugins":["expandable-chapters","copy"],"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"copy":{},"expandableChapters":{"cssFile":["expandable-chapters-theme.css"]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"website.css"}},"file":{"path":"new-vpc-api.md","mtime":"2019-04-12T02:02:38.644Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-04-12T02:02:41.402Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-copy/js/clipboard.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-copy/js/copy.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

